<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lucky Wheel</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f5f7f0;
    text-align: center;
    color: #e94f4f;
  }

  /* Halaman input */
  #inputPage {
    display: block;
    padding: 20px;
  }
  #spinnerPage {
    display: none;
  }

  h1 {
    font-size: 40px;
    font-weight: bold;
    margin: 10px 0;
  }
  h1 span:first-child { color: #14b8b6; }
  h1 span:last-child { color: #e94f4f; }

  .name-inputs {
    margin: 20px auto;
    max-width: 300px;
  }
  .name-inputs input {
    width: 100%;
    padding: 8px;
    margin: 5px 0;
    border-radius: 6px;
    border: 1px solid #aaa;
    text-align: center;
    font-size: 16px;
  }
  .add-btn {
    margin-top: 10px;
    padding: 8px 15px;
    font-size: 16px;
    font-weight: bold;
    border: none;
    border-radius: 6px;
    background: #e94f4f;
    color: white;
    cursor: pointer;
  }
  .start-btn {
    margin-top: 20px;
    padding: 10px 25px;
    font-size: 18px;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    background: #14b8b6;
    color: white;
    cursor: pointer;
  }

  /* Spinner Page */
  .info-bar {
    display: flex;
    justify-content: space-between;
    margin: 0 40px 10px 40px;
    font-size: 18px;
    font-weight: bold;
  }

  .wheel-container {
    position: relative;
    width: 340px;
    height: 340px;
    margin: 0 auto;
  }

  /* Pointer menghadap ke bawah */
  .pointer {
    position: absolute;
    bottom: 320px;
    left: 50%;
    transform: translateX(-50%) rotate(180deg);
    width: 0; 
    height: 0; 
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 40px solid #fff;
    z-index: 10;
    transition: transform 0.1s ease;
  }

  canvas {
    border-radius: 50%;
    background: #fff;
  }

  .spin-btn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 110px;
    height: 110px;
    border-radius: 50%;
    background: #f9e4b7;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #e94f4f;
    font-weight: bold;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 3px 3px 6px rgba(0,0,0,0.3);
    user-select: none;
  }

  .circle-btns {
    display: flex;
    justify-content: center;
    gap: 50px;
    margin-top: 30px;
  }
  .circle-btn {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 3px 3px 6px rgba(0,0,0,0.3);
    color: white;
  }
  .back { background: #999; }
  .home { background: #14b8b6; }

  /* Hasil pemenang */
  #winner {
    margin-top: 20px;
    font-size: 22px;
    font-weight: bold;
    color: #14b8b6;
  }

  /* Titik secret mode */
  #secretDot {
    position: fixed;
    bottom: 8px;
    right: 8px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #999;
    cursor: pointer;
  }
  #secretDot.on {
    background: #14b8b6;
  }
</style>
</head>
<body>

<!-- Halaman Input Nama -->
<div id="inputPage">
  <h1><span>INPUT</span> <span>NAMES</span></h1>
  <div class="name-inputs" id="nameInputs">
    <input type="text" placeholder="Nama 1">
    <input type="text" placeholder="Nama 2">
  </div>
  <button class="add-btn" onclick="addInput()">+ Tambah Peserta</button><br>
  <button class="start-btn" onclick="startGame()">Start</button>
</div>

<!-- Halaman Spinner -->
<div id="spinnerPage">
  <h1><span>LUCKY</span> <span>WHEEL</span></h1>

  <div class="info-bar">
    <div>Drawn: <span id="drawn">0</span></div>
    <div>Repeat: Yes</div>
  </div>

  <div class="wheel-container">
    <div class="pointer" id="pointer"></div>
    <canvas id="wheel" width="340" height="340"></canvas>
    <div class="spin-btn" onclick="spinWheel()">SPIN</div>
  </div>

  <div id="winner"></div>

  <div class="circle-btns">
    <div class="circle-btn back" onclick="goBack()">back</div>
    <div class="circle-btn home" onclick="goBack()">home</div>
  </div>

  <audio id="tickSound" src="https://actions.google.com/sounds/v1/alarms/click_clock.ogg"></audio>
</div>

<!-- Titik rahasia -->
<div id="secretDot" onclick="toggleSecretMode()"></div>

<script>
  const wheelCanvas = document.getElementById("wheel");
  const ctx = wheelCanvas.getContext("2d");
  const tickSound = document.getElementById("tickSound");
  const pointer = document.getElementById("pointer");
  const secretDot = document.getElementById("secretDot");

  let options = [];
  const colors = ["#4dd0e1","#81c784","#ffd54f","#ba68c8",
                  "#ff8a65","#a1887f","#64b5f6","#f06292"];
  let arc;
  let startAngle = 0;
  let spinning = false;
  let secretMode = false;

  function toggleSecretMode() {
    secretMode = !secretMode;
    secretDot.classList.toggle("on", secretMode);
  }

  function addInput() {
    const container = document.getElementById("nameInputs");
    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = "Nama " + (container.children.length + 1);
    container.appendChild(input);
  }

  function startGame() {
    const inputs = document.querySelectorAll("#nameInputs input");
    options = Array.from(inputs).map(inp => inp.value.trim()).filter(v => v);
    if (options.length < 2) {
      alert("Masukkan minimal 2 nama!");
      return;
    }
    arc = Math.PI * 2 / options.length;
    document.getElementById("inputPage").style.display = "none";
    document.getElementById("spinnerPage").style.display = "block";
    drawWheel();
  }

  function drawWheel(angle=0) {
    ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
    for (let i = 0; i < options.length; i++) {
      let a = angle + i * arc;
      ctx.beginPath();
      ctx.fillStyle = colors[i % colors.length];
      ctx.moveTo(170, 170);
      ctx.arc(170, 170, 170, a, a + arc);
      ctx.fill();
      ctx.save();
      ctx.translate(170, 170);
      ctx.rotate(a + arc / 2);
      ctx.fillStyle = "#fff";
      ctx.font = "bold 20px Arial";
      ctx.textAlign = "right";
      ctx.fillText(options[i], 160, 10);
      ctx.restore();
    }
  }

  function spinWheel() {
    if (spinning) return;
    spinning = true;
    document.getElementById("winner").textContent = "";

    let spinTime = 0;
    let spinDuration = 10000; // 10 detik
    let targetAngle;

    // cek secret mode
    let ramaIndex = options.findIndex(o => o.toLowerCase() === "rama");
    if (secretMode && ramaIndex !== -1) {
      // paksa roda berhenti di Rama
      let sliceAngle = arc * ramaIndex;
      let pointerAngle = 3 * Math.PI / 2; // pointer bawah
      targetAngle = pointerAngle - (sliceAngle + arc / 2);
      targetAngle += Math.PI * 6; // tambah putaran biar realistis
    } else {
      targetAngle = startAngle + (Math.random() * 360 + 1800) * Math.PI / 180;
    }

    function animateSpin() {
      spinTime += 20;
      if (spinTime >= spinDuration) {
        spinning = false;
        startAngle = targetAngle % (2 * Math.PI);

        let winner;
        if (secretMode && ramaIndex !== -1) {
          winner = "Rama";
        } else {
          let degrees = startAngle * 180 / Math.PI + 90;
          let index = Math.floor((360 - (degrees % 360)) / (360 / options.length));
          winner = options[index];
        }

        document.getElementById("winner").textContent = "ðŸŽ‰ Pemenang: " + winner + " ðŸŽ‰";
        return;
      }
      let ease = easeOut(spinTime, 0, 1, spinDuration);
      let currentAngle = startAngle + ease * (targetAngle - startAngle);
      drawWheel(currentAngle);

      if (Math.random() < 0.08) {
        pointer.style.transform = "translateX(-50%) rotate(180deg) rotate(-15deg)";
        setTimeout(()=> pointer.style.transform = "translateX(-50%) rotate(180deg)",100);
        tickSound.currentTime = 0;
        tickSound.play();
      }

      requestAnimationFrame(animateSpin);
    }
    animateSpin();
  }

  function easeOut(t, b, c, d) {
    t /= d;
    return -c * t*(t-2) + b;
  }

  function goBack() {
    document.getElementById("spinnerPage").style.display = "none";
    document.getElementById("inputPage").style.display = "block";
  }
</script>
</body>
</html>